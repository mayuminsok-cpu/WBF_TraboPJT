<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Marker-based Animal AR - Emotion Switch</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v7.2.0/dist/aframe-extras.min.js"></script>

    <!-- External CSS -->
    <link rel="stylesheet" href="style.css">

    <!-- External JS -->
    <script src="script.js"></script>
</head>

<body style="margin: 0; overflow: hidden;">
    <!-- UI„Éú„Çø„É≥ -->
    <button id="connect-btn" class="ui-button">üé§ Èü≥Â£∞Êé•Á∂öÈñãÂßã</button>
    <button id="summon-btn" class="ui-button">„ÅΩ„ÅÑ„Å£„Å®„Åè„Çì<br>Âè¨ÂñöÔºÅ</button>
    <div id="status">Êú™Êé•Á∂ö</div>

    <button id="happy-btn" class="ui-button">üòä Âñú„Å≥</button>
    <button id="angry-btn" class="ui-button">üò† ÊÄí„Çä</button>

    <!-- „É°„ÉÉ„Çª„Éº„Ç∏„Éú„ÉÉ„ÇØ„Çπ -->
    <div id="message-box">
        „Ç¥„Éü„ÇíÊç®„Å¶„Å¶„Å≠ÔºÅ
    </div>

    <!-- Emotion Icon Overlay -->
    <div id="emotion-overlay" class="emotion-icon-overlay"></div>

    <a-scene embedded
        arjs='sourceType: webcam; trackingMethod: best; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;'
        renderer="antialias: false; precision: medium; logarithmicDepthBuffer: true; colorManagement: true;"
        vr-mode-ui="enabled: false">

        <a-assets>
            <!-- Happy animations (3 variants) -->
            <a-asset-item id="happy-1-asset"
                src="chibi_remake_Animation_Happy_Sway_Standing_withSkin_1.glb?v=1"></a-asset-item>
            <a-asset-item id="happy-2-asset"
                src="chibi_remake_Animation_Joyful_Dance_with_Hand_Sway_withSkin.glb?v=1"></a-asset-item>
            <a-asset-item id="happy-3-asset"
                src="chibi_remake_Animation_Excited_Walk_F_withSkin.glb?v=1"></a-asset-item>

            <!-- Angry animations (1 variant) -->
            <a-asset-item id="angry-asset"
                src="chibi_remake_Animation_Angry_Ground_Stomp_2_withSkin_1.glb?v=1"></a-asset-item>

            <!-- Joyful (idle/waiting state) -->
            <a-asset-item id="joyful-asset" src="chibi_remake_Animation_Idle_4_withSkin.glb?v=1"></a-asset-item>

            <!-- Recycle Buddy (Evolved Stage) -->
            <a-asset-item id="buddy-idle-asset" src="revel2_idle.glb"></a-asset-item>
            <a-asset-item id="buddy-happy-1-asset" src="revel2_happy1.glb"></a-asset-item>
            <a-asset-item id="buddy-happy-2-asset" src="revel2_happy2.glb"></a-asset-item>
            <a-asset-item id="buddy-angry-asset" src="revel2_angry.glb"></a-asset-item>
            <!-- Level 3 Evolution (Stage 3) -->
            <a-asset-item id="stage3-asset" src="revel3_idle.glb"></a-asset-item>
        </a-assets>

        <!-- Custom Marker -->
        <a-marker type='pattern' url='pattern-WBF.patt?v=3'>

            <a-entity id="model-container">
                <!-- Chibi Group (Initial Stage) -->
                <a-entity id="chibi-group">
                    <!-- Joyful (Idle/Waiting State) -->
                    <a-gltf-model id="joyful-model" src="#joyful-asset" position="0 0 0" rotation="0 0 0" scale="3 3 3"
                        animation-mixer="clip: Armature|Idle_4|baselayer; loop: repeat; timeScale: 1" visible="false"
                        model-logger>
                    </a-gltf-model>

                    <!-- Happy Models (3 variants) -->
                    <a-gltf-model id="happy-1-model" src="#happy-1-asset" position="0 0 0" rotation="0 0 0"
                        scale="3 3 3"
                        animation-mixer="clip: Armature|Happy_Sway_Standing|baselayer; loop: repeat; timeScale: 1"
                        visible="false" model-logger>
                    </a-gltf-model>
                    <a-gltf-model id="happy-2-model" src="#happy-2-asset" position="0 0 0" rotation="0 0 0"
                        scale="3 3 3"
                        animation-mixer="clip: Armature|Joyful_Dance_with_Hand_Sway|baselayer; loop: repeat; timeScale: 1"
                        visible="false" model-logger>
                    </a-gltf-model>
                    <a-gltf-model id="happy-3-model" src="#happy-3-asset" position="0 0 0" rotation="0 0 0"
                        scale="3 3 3"
                        animation-mixer="clip: Armature|Excited_Walk_F|baselayer; loop: repeat; timeScale: 1"
                        visible="false" model-logger>
                    </a-gltf-model>

                    <!-- Angry Models (1 variant) -->
                    <a-gltf-model id="angry-model" src="#angry-asset" position="0 0 0" rotation="0 0 0" scale="3 3 3"
                        animation-mixer="clip: Armature|Angry_Ground_Stomp_2|baselayer; loop: repeat; timeScale: 1"
                        visible="false" model-logger>
                    </a-gltf-model>
                </a-entity>

                <!-- Buddy Group (Evolved Stage) -->
                <a-entity id="buddy-group" visible="false">
                    <!-- Buddy Idle (Standard) -->
                    <a-gltf-model id="buddy-idle-model" src="#buddy-idle-asset" position="0 0 0" rotation="0 0 0"
                        scale="3 3 3" animation-mixer="loop: repeat" visible="false" model-logger>
                    </a-gltf-model>

                    <!-- Buddy Happy (2 variants) -->
                    <a-gltf-model id="buddy-happy-1-model" src="#buddy-happy-1-asset" position="0 0 0" rotation="0 0 0"
                        scale="3 3 3" animation-mixer="loop: repeat" visible="false" model-logger>
                    </a-gltf-model>
                    <a-gltf-model id="buddy-happy-2-model" src="#buddy-happy-2-asset" position="0 0 0" rotation="0 0 0"
                        scale="3 3 3" animation-mixer="loop: repeat" visible="false" model-logger>
                    </a-gltf-model>

                    <!-- Buddy Angry -->
                    <a-gltf-model id="buddy-angry-model" src="#buddy-angry-asset" position="0 0 0" rotation="0 0 0"
                        scale="3 3 3" animation-mixer="loop: repeat" visible="false" model-logger>
                    </a-gltf-model>
                </a-entity>

                <!-- Stage 3 Group (Super Evolved) -->
                <a-entity id="stage3-group" visible="false">
                    <!-- Stage 3 Idle -->
                    <a-gltf-model id="stage3-idle-model" src="#stage3-asset" position="0 0 0" rotation="0 0 0"
                        scale="3 3 3" animation-mixer="loop: repeat" visible="false" model-logger>
                    </a-gltf-model>
                    <!-- Stage 3 Happy (Placeholder: Uses idle asset but will be colored Gold) -->
                    <a-gltf-model id="stage3-happy-model" src="#stage3-asset" position="0 0 0" rotation="0 0 0"
                        scale="3 3 3" animation-mixer="loop: repeat" visible="false" model-logger>
                    </a-gltf-model>
                    <!-- Stage 3 Angry (Placeholder: Uses idle asset but will be colored Red) -->
                    <a-gltf-model id="stage3-angry-model" src="#stage3-asset" position="0 0 0" rotation="0 0 0"
                        scale="3 3 3" animation-mixer="loop: repeat" visible="false" model-logger>
                    </a-gltf-model>
                </a-entity>

                <!-- Anger Icon (üí¢) -->
                <a-text id="anger-icon" value="üí¢" position="-0.5 2 0" rotation="0 0 0" scale="2 2 2" color="#FF0000"
                    align="center" visible="false">
                </a-text>

                <!-- Heart Icon (‚ù§) -->
                <a-text id="heart-icon" value="‚ù§" position="-0.5 2 0" rotation="0 0 0" scale="2 2 2" color="#FF1493"
                    align="center" visible="false">
                </a-text>
            </a-entity>

        </a-marker>

        <!-- Hiro Marker -->
        <a-marker preset="hiro">
            <a-gltf-model src="#buddy-asset" position="0 0 0" rotation="0 0 0" scale="1.5 1.5 1.5"
                animation-mixer="loop: once">
            </a-gltf-model>
        </a-marker>

        <a-entity camera></a-entity>

    </a-scene>
</body>

</html>